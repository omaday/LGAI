# Avalanche 本地部署一条 Subnet 公链（附图 + 配置 + 源码）

本指南在本地部署一条 Avalanche Subnet 公链，用户测试 订阅Bot 服务。

---

## 📦 所需工具

- Node.js（建议 v18+）

- Avalanche-CLI

- Docker（可选，用于子网节点隔离）

---

## 🧰 安装 Avalanche-CLI

```bash
curl -sSfL https://raw.githubusercontent.com/ava-labs/avalanche-cli/main/scripts/install.sh | sh -s
export PATH=~/bin:$PATH
```

验证安装：

```bash
avalanche --version
```

---

## ⚙️ 创建 Subnet 配置

```bash
avalanche subnet create mySubnet
```

按提示填写：

| 选项       | 建议值               |
| -------- | ----------------- |
| VM 类型    | SubnetEVM         |
| Chain ID | 12345（可自定义）       |
| 原生代币符号   | TET               |
| Gas 费设定  | 1.5 mil gas/s（默认） |
| 预编译      | 否                 |

示意图：

![subnet create](https://raw.githubusercontent.com/ava-labs/avalanche-cli/main/docs/images/subnet-create.png)

---

## 🚀 本地部署 Subnet

```bash
avalanche subnet deploy mySubnet --local
```

CLI 会启动多个节点，并显示 RPC 端口信息，例如：

```
Local network node endpoints:
node2: http://127.0.0.1:9652/ext/bc/<chainID>/rpc
node3: http://127.0.0.1:9654/ext/bc/<chainID>/rpc
```

---

## 🖥️ 配置 MetaMask

添加网络：

- 网络名称：MySubnet Local

- RPC URL：http://127.0.0.1:9652/ext/bc//rpc

- Chain ID：12345

- 代币符号：TET

示意图：

![metamask subnet](https://docs.avax.network/_images/metamask_subnet.png)

---

## 🔧 Subnet 配置文件结构（位于 ~/.avalanche-cli/configs/subnets/mySubnet/）

```json
{
  "vm": "subnet-evm",
  "name": "mySubnet",
  "tokenName": "TET",
  "subnetEVMGenesis": {
    "config": {
      "chainId": 12345,
      "homesteadBlock": 0,
      "eip150Block": 0,
      "eip155Block": 0,
      "eip158Block": 0,
      "byzantiumBlock": 0
    },
    "alloc": {},
    "nonce": "0x0",
    "difficulty": "0x1",
    "gasLimit": "0x7A1200"
  }
}
```

如需预部署账号或代币分配，可编辑 `alloc`：

```json
"alloc": {
  "0xYourAddress": {
    "balance": "0xDE0B6B3A7640000"
  }
}
```

---

## 🧹 清理网络（重置）

```bash
avalanche network clean
```

---

## 🧪 可选：部署合约进行测试

使用 Remix IDE 或 Hardhat 连接 RPC http://127.0.0.1:9652/ext/bc/xxx/rpc 进行合约部署和测试。

---

## 📬 下一步：连接 Telegram Bot

- 连接合约地址、用户地址与 Bot 的 chatId

- 查询订阅有效期（从合约读取）

- 实现订阅状态推送或定期续费提示


